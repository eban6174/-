<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>바코드 생성기</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <style>
        /* 기본 스타일 (웹 페이지에 표시될 스타일) */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: #f4f4f4;
        }

        #barcodeWrapper {
            display: inline-block;
            text-align: center;
            margin-top: 30px;
        }

        #barcode {
            margin-top: 20px;
        }

        #barcodeNumber {
            font-size: 24px;
            margin-top: 10px;
        }

        #customText {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            width: 300px;
        }

        #barcodeData {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            width: 300px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
        }

        button:hover {
            background-color: #45a049;
        }

        /* 인쇄 스타일 (웹 페이지에서 인쇄시 적용) */
        @media print {
            /* 웹 페이지의 나머지 내용 숨기기 */
            body {
                visibility: hidden; /* 웹 페이지의 모든 내용 숨김 */
            }

            /* 바코드 관련 내용만 보이게 설정 */
            #barcodeWrapper {
                visibility: visible;
                position: absolute;
                left: 0;
                top: 50%;
                transform: translateY(-50%); /* 수직 중앙 정렬 */
                text-align: center;
                width: 100%;
                padding: 10mm;
            }

            #barcode {
                width: 50%; /* 바코드 크기 조정 (50%로 줄임) */
                height: auto;
            }

            #barcodeNumber {
                font-size: 48px; /* 바코드 아래 숫자 크기 증가 */
                margin-top: 10px;
                color: black; /* 글자 색을 검정으로 설정 */
            }

            #customTextDisplay {
                font-size: 60px; /* 바코드 위 텍스트 크기 증가 */
                margin-top: 20px;
                font-weight: bold;
                color: black; /* 글자 색을 검정으로 설정 */
            }

            /* 인쇄할 때 여백 조정 */
            @page {
                margin: 0;
            }

            /* 페이지 상단의 여백 제거 */
            html, body {
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>

    <h1>바코드 생성기</h1>
    <label for="barcodeData">바코드 데이터:</label>
    <input type="text" id="barcodeData" placeholder="바코드 데이터를 입력하세요">
    <br><br>
    <label for="customText">내용:</label>
    <input type="text" id="customText" placeholder="추가할 내용을 입력하세요">
    <br><br>
    <button onclick="generateBarcode()">바코드 생성</button>

    <div id="barcodeWrapper">
        <!-- 바코드 위에 텍스트 -->
        <div id="customTextDisplay"></div>
        
        <!-- 바코드 이미지가 표시될 곳 -->
        <svg id="barcode"></svg>

        <!-- 바코드 숫자 아래에 표시될 텍스트 -->
        <div id="barcodeNumber"></div>
    </div>

    <!-- 인쇄 버튼 -->
    <button id="printButton" onclick="printBarcode()">인쇄</button>

    <script>
        function generateBarcode() {
            const data = document.getElementById("barcodeData").value.trim();  // 사용자 입력값 받기

            // 입력값이 비어있으면 경고 메시지
            if (!data) {
                alert("바코드 데이터를 입력해주세요.");
                return;
            }

            // 입력값에 특수문자나 공백이 포함되면 제거 (숫자와 알파벳만 허용)
            const sanitizedData = data.replace(/[^A-Za-z0-9]/g, '');  // 알파벳과 숫자만 허용

            // 만약 특수문자나 공백을 모두 제거한 결과 값이 비어있으면
            if (!sanitizedData) {
                alert("바코드 데이터에는 알파벳과 숫자만 입력할 수 있습니다.");
                return;
            }

            console.log("바코드 생성 중:", sanitizedData);  // 디버깅용 로그

            try {
                // 바코드 생성 (Code128 형식 사용)
                JsBarcode("#barcode", sanitizedData, {
                    format: "CODE128",  // CODE128 바코드 형식 사용
                    width: 2,           // 바코드 선의 두께
                    height: 100,        // 바코드의 높이
                    displayValue: true,  // 바코드 숫자 아래에 값 표시
                });

                // 바코드 숫자 아래에 표시할 숫자 값 업데이트
                const barcodeNumber = document.getElementById("barcodeNumber");
                barcodeNumber.textContent = sanitizedData;

                // 사용자 입력 내용 (추가 텍스트)
                const customText = document.getElementById("customText").value.trim();
                const customTextDisplay = document.getElementById("customTextDisplay");
                if (customText) {
                    customTextDisplay.textContent = customText; // 바코드 위 텍스트 추가
                }

                // 인쇄 버튼 표시
                document.getElementById("printButton").style.display = "inline-block"; 

            } catch (error) {
                // 오류 처리
                console.error("바코드 생성 중 오류 발생:", error);
                alert("바코드 생성에 실패했습니다. 입력값을 확인해주세요.");
            }
        }

        // 인쇄 함수
        function printBarcode() {
            window.print();
        }
    </script>

</body>
</html>
